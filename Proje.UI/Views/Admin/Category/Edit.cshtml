@model Proje.UI.Models.DTOs.CategoryDTO
@{
    ViewData["Title"] = "Kategori Düzenle";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var categories = ViewBag.Categories as IEnumerable<Proje.UI.Models.DTOs.CategoryDTO>;
}

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Kategori Düzenle</h1>
</div>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Kategori Bilgileri</h6>
    </div>
    <div class="card-body">
        <form id="editCategoryForm">
            <input type="hidden" id="Id" name="Id" value="@Model.Id">

            <div class="form-group">
                <label for="Name">Kategori Adı</label>
                <input type="text" class="form-control" id="Name" name="Name" value="@Model.Name" required>
            </div>

            <div class="form-group">
                <label for="Description">Açıklama</label>
                <textarea class="form-control" id="Description" name="Description" rows="3">@Model.Description</textarea>
            </div>

            <div class="form-group">
                <label for="ParentCategoryId">Üst Kategori</label>
                <select class="form-control" id="ParentCategoryId" name="ParentCategoryId">
                    <option value="">Ana Kategori</option>
                    @if (categories != null)
                    {
                        foreach (var category in categories.Where(c => c.Id != Model.Id))
                        {
                            <option value="@category.Id" @(Model.ParentCategoryId == category.Id ? "selected" : "")>@category.Name</option>
                        }
                    }
                </select>
            </div>

            <div class="form-group">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="IsActive" name="IsActive" @(Model.IsActive ? "checked" : "")>
                    <label class="custom-control-label" for="IsActive">Aktif</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Güncelle</button>
            <a href="/Admin/Category" class="btn btn-secondary">İptal</a>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#editCategoryForm').on('submit', function(e) {
                e.preventDefault();

                var formData = {
                    Id: $('#Id').val(),
                    Name: $('#Name').val(),
                    Description: $('#Description').val(),
                    ParentCategoryId: $('#ParentCategoryId').val() || null,
                    IsActive: $('#IsActive').is(':checked')
                };

                $.ajax({
                    url: '/Admin/Category/Edit/' + $('#Id').val(),
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        if (response.success) {
                            alert('Kategori başarıyla güncellendi.');
                            window.location.href = '/Admin/Category';
                        } else {
                            alert('Kategori güncellenirken bir hata oluştu: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('Kategori güncellenirken bir hata oluştu: ' + error);
                    }
                });
            });
        });
    </script>
}