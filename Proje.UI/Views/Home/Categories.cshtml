@section Scripts {
<script>
    $(document).ready(function(){
        var apiBaseUrl = "@ViewBag.ApiBaseURL";
        if(localStorage.getItem("token") == "" || localStorage.getItem("token") == null){
            location.href = "/Login";
            return false;
        }
        var token = localStorage.getItem("token");
        var userRoles = localStorage.getItem("userRoles") ? localStorage.getItem("userRoles").split(", ") : [];

        GetCategoryList();
        LoadParentCategories();
        $("#btnCancel").hide();
        $("#btnEdit").hide();
        $("#btnDelete").hide();

        function GetCategoryList(){
            $.ajax({
                url: apiBaseUrl + "/Category",
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (d) {
                    CategoryToTable(d);
                },
                error: function (d) {
                    if(d.status === 401) {
                        localStorage.removeItem("token");
                        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                        location.href = "/Login";
                    } else {
                        showNotification("Kategoriler yüklenirken bir hata oluştu", "error");
                    }
                },
            });
        }

        function LoadParentCategories() {
            $.ajax({
                url: apiBaseUrl + "/Category",
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (d) {
                    $("#cbParentCategory").empty();
                    $("#cbParentCategory").append('<option value="">Ana Kategori</option>');

                    $.each(d, function(i, item) {
                        $("#cbParentCategory").append('<option value="' + item.id + '">' + item.name + '</option>');
                    });
                },
                error: function (d) {
                    showNotification("Üst kategoriler yüklenirken bir hata oluştu", "error");
                },
            });
        }

        // Kategorileri tabloya doldur
        function CategoryToTable(data){
            // Mevcut kod aynı kalabilir
        }

        $("#btnSave").click(function(){
            if($("#txtName").val() == "" || $("#txtName").val() == null){
                showNotification("Kategori Adı Giriniz!", "error");
                return false;
            }
            var name = $("#txtName").val();
            var description = $("#txtDescription").val();
            var parentCategoryId = $("#cbParentCategory").val();
            var isActive = $("#cbIsActive").is(":checked");
            var category = {
                name: name,
                description: description,
                parentCategoryId: parentCategoryId || null,
                isActive: isActive
            };

            $.ajax({
                url: apiBaseUrl + "/Category",
                type: "POST",
                headers: {
                    "Authorization": "Bearer " + token
                },
                data: JSON.stringify(category),
                contentType: "application/json",
                success: function (d) {
                    if (d.status){
                        showNotification("Kategori başarıyla eklendi", "success");
                        GetCategoryList();
                        LoadParentCategories();
                        // Formu temizle
                        $("#txtName").val("");
                        $("#txtDescription").val("");
                        $("#cbParentCategory").val("");
                        $("#cbIsActive").prop("checked", true);
                    } else {
                        showNotification(d.message, "error");
                    }
                },
                error: function (d) {
                    showNotification("Kategori eklenirken bir hata oluştu", "error");
                },
            });
        });

        $(document).on("click", ".btnEdit", function(){
            var id = $(this).attr("data-id");
            $.ajax({
                url: apiBaseUrl + "/Category/" + id,
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                contentType: "application/json",
                success: function (d) {
                    $("#btnSave").hide();
                    $("#btnCancel").show();
                    $("#btnEdit").show();
                    $("#btnDelete").show();
                    $("#txtId").val(d.id);
                    $("#txtName").val(d.name);
                    $("#txtDescription").val(d.description);
                    $("#cbParentCategory").val(d.parentCategoryId || "");
                    $("#cbIsActive").prop("checked", d.isActive);
                },
                error: function (d) {
                    showNotification("Kategori bilgileri yüklenirken bir hata oluştu", "error");
                },
            });
        });

        $("#btnCancel").click(function(){
            $("#btnCancel").hide();
            $("#btnEdit").hide();
            $("#btnDelete").hide();
            $("#btnSave").show();
            $("#txtName").val("");
            $("#txtDescription").val("");
            $("#cbParentCategory").val("");
            $("#txtId").val("");
            $("#cbIsActive").prop("checked", true);
        });

        $("#btnEdit").click(function(){
            if($("#txtName").val() == "" || $("#txtName").val() == null){
                showNotification("Kategori Adı Giriniz!", "error");
                return false;
            }
            var id = $("#txtId").val();
            var name = $("#txtName").val();
            var description = $("#txtDescription").val();
            var parentCategoryId = $("#cbParentCategory").val();
            var isActive = $("#cbIsActive").is(":checked");
            var category = {
                id: id,
                name: name,
                description: description,
                parentCategoryId: parentCategoryId || null,
                isActive: isActive
            };

            $.ajax({
                url: apiBaseUrl + "/Category/" + id,
                type: "PUT",
                headers: {
                    "Authorization": "Bearer " + token
                },
                data: JSON.stringify(category),
                contentType: "application/json",
                success: function (d) {
                    if (d.status){
                        showNotification("Kategori başarıyla güncellendi", "success");
                        GetCategoryList();
                        LoadParentCategories();
                        $("#btnCancel").click();
                    } else {
                        showNotification(d.message, "error");
                    }
                },
                error: function (d) {
                    showNotification("Kategori güncellenirken bir hata oluştu", "error");
                },
            });
        });

        $("#btnDelete").click(function(){
            var id = $("#txtId").val();
            if (confirm("Bu kategoriyi silmek istediğinizden emin misiniz?")) {
                $.ajax({
                    url: apiBaseUrl + "/Category/" + id,
                    type: "DELETE",
                    headers: {
                        "Authorization": "Bearer " + token
                    },
                    contentType: "application/json",
                    success: function (d) {
                        if (d.status){
                            showNotification("Kategori başarıyla silindi", "success");
                            GetCategoryList();
                            LoadParentCategories();
                            $("#btnCancel").click();
                        } else {
                            showNotification(d.message, "error");
                        }
                    },
                    error: function (d) {
                        showNotification("Kategori silinirken bir hata oluştu", "error");
                    },
                });
            }
        });
    });
</script>
}