<script>
    $(document).ready(function(){
        var apiBaseUrl = "@ViewBag.ApiBaseURL";

        $("#btnLogin").click(function(){
            if($("#txtUserName").val()=="" || $("#txtUserName").val()==null || $("#txtPassword").val()=="" || $("#txtPassword").val()==null){
                showNotification("Kullanıcı Adı ve Parola Giriniz!", "error");
                return false;
            }

            var userName = $("#txtUserName").val();
            var password = $("#txtPassword").val();

            var login = new Object();
            login.Username = userName;
            login.Password = password;

            $.ajax({
                url: apiBaseUrl + "/Account/login",
                type: "POST",
                data: JSON.stringify(login),
                contentType: "application/json",
                success: function (d) {
                    if (d.status){
                        // Token bilgisini sakla
                        localStorage.setItem("token", d.data.token);
                        // Cookie olarak da saklayalım (güvenli)
                        document.cookie = "token=" + d.data.token + "; path=/";

                        localStorage.setItem("userName", d.data.username);
                        localStorage.setItem("userId", d.data.id);
                        localStorage.setItem("userRoles", d.data.roles.join(", "));
                        localStorage.setItem("userPhoto", "profil.jpg"); // Varsayılan profil resmi

                        showNotification("Giriş başarılı, yönlendiriliyorsunuz...", "success");

                        // Ana sayfaya yönlendir
                        setTimeout(function() {
                            location.href = "/";
                        }, 1000);
                    } else {
                        showNotification(d.message, "error");
                    }
                },
                error: function (d) {
                    showNotification("Bağlantı hatası oluştu!", "error");
                }
            });
        });

        // Enter tuşuna basılınca giriş yap
        $("#txtPassword").on("keypress", function (e) {
            if (e.which === 13) {
                $("#btnLogin").click();
            }
        });
    });
</script>