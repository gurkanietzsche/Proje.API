@model Proje.UI.Models.DTOs.ProductDTO
@{
    ViewData["Title"] = "Ürün Düzenle";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var categories = ViewBag.Categories as IEnumerable<Proje.UI.Models.DTOs.CategoryDTO>;
}

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Ürün Düzenle</h1>
</div>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Ürün Bilgileri</h6>
    </div>
    <div class="card-body">
        <form id="editProductForm">
            <input type="hidden" id="Id" name="Id" value="@Model.Id">

            <div class="form-group">
                <label for="Name">Ürün Adı</label>
                <input type="text" class="form-control" id="Name" name="Name" value="@Model.Name" required>
            </div>

            <div class="form-group">
                <label for="Description">Açıklama</label>
                <textarea class="form-control" id="Description" name="Description" rows="3">@Model.Description</textarea>
            </div>

            <div class="form-group">
                <label for="Price">Fiyat</label>
                <input type="number" class="form-control" id="Price" name="Price" step="0.01" min="0" value="@Model.Price" required>
            </div>

            <div class="form-group">
                <label for="Stock">Stok</label>
                <input type="number" class="form-control" id="Stock" name="Stock" min="0" value="@Model.Stock" required>
            </div>

            <div class="form-group">
                <label for="ImageUrl">Resim URL</label>
                <input type="text" class="form-control" id="ImageUrl" name="ImageUrl" value="@Model.ImageUrl" required>
                <small class="form-text text-muted">Geçerli bir resim URL'si girin.</small>
            </div>

            <div class="form-group">
                <label for="CategoryId">Kategori</label>
                <select class="form-control" id="CategoryId" name="CategoryId" required>
                    <option value="">Kategori Seçin</option>
                    @if (categories != null)
                    {
                        foreach (var category in categories)
                        {
                            <option value="@category.Id" @(Model.CategoryId == category.Id ? "selected" : "")>@category.Name</option>
                        }
                    }
                </select>
            </div>

            <div class="form-group">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="IsActive" name="IsActive" @(Model.IsActive ? "checked" : "")>
                    <label class="custom-control-label" for="IsActive">Aktif</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Güncelle</button>
            <a href="/Admin/Product" class="btn btn-secondary">İptal</a>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#editProductForm').on('submit', function(e) {
                e.preventDefault();

                var formData = {
                    Id: $('#Id').val(),
                    Name: $('#Name').val(),
                    Description: $('#Description').val(),
                    Price: parseFloat($('#Price').val()),
                    Stock: parseInt($('#Stock').val()),
                    ImageUrl: $('#ImageUrl').val(),
                    CategoryId: parseInt($('#CategoryId').val()),
                    IsActive: $('#IsActive').is(':checked')
                };

                $.ajax({
                    url: '/Admin/Product/Edit/' + $('#Id').val(),
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        if (response.success) {
                            alert('Ürün başarıyla güncellendi.');
                            window.location.href = '/Admin/Product';
                        } else {
                            alert('Ürün güncellenirken bir hata oluştu: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('Ürün güncellenirken bir hata oluştu: ' + error);
                    }
                });
            });
        });
    </script>
}